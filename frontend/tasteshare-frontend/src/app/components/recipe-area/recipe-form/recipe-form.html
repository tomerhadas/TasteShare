<mat-card class="recipe-form-card">
  <h2>{{ isEditMode ? 'Edit Recipe' : 'Add Recipe' }}</h2>

  <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
    <!-- Basic Info -->
    <mat-form-field appearance="outline">
      <mat-label>Title</mat-label>
      <input matInput formControlName="title" />
      <mat-error *ngIf="recipeForm.get('title')?.hasError('required')">
        Title is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea
        matInput
        rows="3"
        formControlName="description"
      ></textarea>
      <mat-error *ngIf="recipeForm.get('description')?.hasError('required')">
        Description is required
      </mat-error>
    </mat-form-field>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Servings</mat-label>
        <input type="number" matInput formControlName="servings" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Prep Minutes</mat-label>
        <input type="number" matInput formControlName="prepMinutes" />
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Cook Minutes</mat-label>
        <input type="number" matInput formControlName="cookMinutes" />
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Difficulty</mat-label>
        <mat-select formControlName="difficulty">
          <mat-option
            *ngFor="let option of difficultyOptions"
            [value]="option.value"
          >
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Food Type</mat-label>
        <mat-select formControlName="foodType">
          <mat-option
            *ngFor="let option of foodTypeOptions"
            [value]="option.value"
          >
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <mat-checkbox formControlName="isKosher">Kosher</mat-checkbox>

    <!-- Ingredients -->
    <h3>Ingredients</h3>
    <div formArrayName="ingredients">
      <div
        class="ingredient-row"
        *ngFor="let ingredient of ingredients.controls; let i = index"
        [formGroupName]="i"
      >
        <mat-form-field appearance="outline" class="ingredient-field">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="ingredient-field">
          <mat-label>Quantity</mat-label>
          <input type="number" matInput formControlName="quantity" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="ingredient-field">
          <mat-label>Unit</mat-label>
          <mat-select formControlName="unit">
            <mat-option *ngFor="let unit of unitOptions" [value]="unit">
              {{ unit }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button
          mat-icon-button
          color="warn"
          type="button"
          (click)="removeIngredient(i)"
          *ngIf="ingredients.length > 1"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
    <button mat-button color="primary" type="button" (click)="addIngredient()">
      <mat-icon>add</mat-icon> Add Ingredient
    </button>

    <!-- Steps -->
    <h3>Steps</h3>
    <div formArrayName="steps">
      <div
        class="step-row"
        *ngFor="let step of steps.controls; let i = index"
        [formGroupName]="i"
      >
        <mat-form-field appearance="outline" class="step-field">
          <mat-label>Step {{ i + 1 }}</mat-label>
          <textarea matInput rows="2" formControlName="instruction"></textarea>
        </mat-form-field>

        <button
          mat-icon-button
          color="warn"
          type="button"
          (click)="removeStep(i)"
          *ngIf="steps.length > 1"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
    <button mat-button color="primary" type="button" (click)="addStep()">
      <mat-icon>add</mat-icon> Add Step
    </button>

    <!-- Submit -->
    <button
      mat-raised-button
      color="accent"
      type="submit"
      [disabled]="isSubmitting"
    >
      {{ isEditMode ? 'Update Recipe' : 'Create Recipe' }}
    </button>
  </form>
</mat-card>
