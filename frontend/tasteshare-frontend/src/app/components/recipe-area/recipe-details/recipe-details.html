<div class="recipe-details-container">
  @if (loading) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading recipe...</p>
  </div>
  } @else if (errorMessage) {
  <div class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ errorMessage }}</p>
    <button mat-raised-button color="primary" routerLink="/recipes">
      Back to Recipes
    </button>
  </div>
  } @else if (recipe) {
  <div class="recipe-content">
    <!-- Header -->
    <div class="recipe-header">
      <div class="recipe-title-section">
        <h1>{{ recipe.title }}</h1>

        <div class="recipe-meta">
          <div class="meta-item">
            <mat-icon>access_time</mat-icon>
            <span>Prep Time: {{ recipe.prepMinutes }} min</span>
          </div>
          <div class="meta-item">
            <mat-icon>timer</mat-icon>
            <span>Cook Time: {{ recipe.cookMinutes }} min</span>
          </div>
          <div class="meta-item">
            <mat-icon>restaurant</mat-icon>
            <span>Servings: {{ recipe.servings }}</span>
          </div>
          <div class="meta-item">
            <mat-icon>
              {{ recipe.difficulty === 0 ? 'looks_one' : recipe.difficulty === 1 ? 'looks_two' : 'looks_3' }}
            </mat-icon>
            <span>
              Difficulty: {{
                recipe.difficulty === 0 ? 'Easy' :
                recipe.difficulty === 1 ? 'Medium' :
                'Hard'
              }}
            </span>
          </div>
        </div>

        <!-- Tags -->
        <div class="recipe-tags">
          <mat-chip-set>
            <mat-chip
              [color]="recipe.foodType === 0 ? 'warn' : recipe.foodType === 1 ? 'primary' : 'accent'">
              {{
                recipe.foodType === 0 ? 'Meat' :
                recipe.foodType === 1 ? 'Dairy' :
                'Parve'
              }}
            </mat-chip>

            @if (recipe.isKosher) {
              <mat-chip color="primary">Kosher</mat-chip>
            }
          </mat-chip-set>
        </div>
      </div>

      <!-- Image -->
      <div class="recipe-image-gallery">
        @if (recipe.images && recipe.images.length > 0) {
        <div class="main-image">
          <img [src]="recipe.images[0].url" [alt]="recipe.title" />
        </div>
        } @else {
        <div class="no-image">
          <mat-icon>no_photography</mat-icon>
          <p>No images available</p>
        </div>
        }
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Description -->
    <div class="recipe-description">
      <h2>Description</h2>
      <p>{{ recipe.description }}</p>
    </div>

    <mat-divider></mat-divider>

    <!-- Tabs -->
    <mat-tab-group mat-align-tabs="center" class="recipe-tabs">
      <mat-tab label="Ingredients">
        <div class="ingredients-container">
          <h2>Ingredients</h2>
          <ul class="ingredients-list">
            @for (ingredient of recipe.ingredients; track ingredient.name) {
            <li>
              <div class="ingredient-item">
                <mat-icon>local_grocery_store</mat-icon>
                <span>{{ ingredient.quantity }} {{ ingredient.unit }} {{ ingredient.name }}</span>
              </div>
            </li>
            }
          </ul>
        </div>
      </mat-tab>

      <mat-tab label="Instructions">
        <div class="steps-container">
          <h2>Instructions</h2>
          <div class="steps-list">
            @for (step of recipe.steps; track step.instruction; let i = $index) {
            <div class="step-item">
              <div class="step-number">{{ i + 1 }}</div>
              <div class="step-content">
                <p>{{ step.instruction }}</p>
              </div>
            </div>
            }
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>

    <mat-divider></mat-divider>

    <!-- Author -->
    <div class="author-info">
      <h2>Author</h2>
      <div class="author-card">
        <mat-icon>person</mat-icon>
        <span>{{ recipe.authorName }}</span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Comments -->
    <div class="comments-section">
      <h2 class="comments-header">Comments & Reviews</h2>
      <app-comment-form [recipeId]="recipeId"></app-comment-form>
      <app-comment-list [recipeId]="recipeId"></app-comment-list>
    </div>
  </div>
  }
</div>
